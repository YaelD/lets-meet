{% extends "base.html" %}

    {% block head-content %}
     {% load static %}
        <link href="{% static 'events/create_event.css' %}" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="{% static 'meetings/create_meeting.css' %}">
        <link href="{% static 'reminders/reminder_form.css' %}" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js" type="text/javascript"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" type="text/javascript"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="https://kit.fontawesome.com/ca9581fda8.js" crossorigin="anonymous"></script>

        <style>
            .participant {
                width: 100%;
                font-size: 1.5rem;
                text-align: left;
                margin-top: 2%;
                margin-bottom: 2%;
                margin-left: 5px;
                color: black;
            }

            .close-btn {
                color: red;
                font-size: 20px;
            }
        </style>

        <script>
            let get_participants_url = "{% url 'get_meeting_participants' meeting_id=event_id %}";

            function delete_participant(id) {
                console.log("deleted " + id);
            }

            function create_rows(data, isCreator) {
                let rows = "";

                data.forEach(element => {
                    let row = "";

                    row =  "<table id='participant" + element.id + "' class='participant'>";
                    row += "    <tr>";
                    row += "        <td colspan=2 style='font-weight: bold;'>" + element.user_id__username + "</td>";
                    row += "    </tr>";
                    row += "    <tr>";
                    row += "        <td width=60%>" + element.user_id__email + "</td>";
                    
                    row += "        <td>" + "0544601142" + "</td>";
                    if (element.user_id__phone_number !== null) {
                        row += "        <td>" + element.user_id__phone_number + "</td>";
                    }
                    if (isCreator === true) {
                        row += "        <td><i class='fa fa-times close-btn' aria-hidden='true' onclick='delete_participant(" + element.id +")'></i></td>";
                    }

                    row += "    </tr>";
                    row += "</table>";
                    
                    rows += row;
                });

                return rows;
            }

            function show_participants(isCreator) {
                let html_text = "";
                $.get(get_participants_url, {}, function(data, status) {
                    html_text = "<table>" +
                                "     <tr>" +
                                "         <table>" +
                                create_rows(data, isCreator) +
                                create_rows(data, isCreator) +
                                create_rows(data, isCreator) +
                                create_rows(data, isCreator) +
                                create_rows(data, isCreator) +
                                create_rows(data, isCreator) +
                                "     </tr>" + 
                                "</table>";

                    console.log(html_text);
                    Swal.fire({
                        title: "<h1 style='font-size: 2.5rem'>Meeting Participants</h1>",
                        html: html_text,
                        background: "linear-gradient(#fff,  #146fa0)",
                        width: "700px",
                        showCloseButton: true,
                        showConfirmButton: false,
                    })
                })
            }

        </script>

    {% endblock %}

    {% block body-content %}
        <div class="container-shadow"></div>
        <div class="container">
            <div class="wrap">
                <div class="headings">
                    <a id="create-event" class="active"><span>{{ title }}:</span></a>
                    <i id="add_alert" class="material-icons">add_alert</i>
                    {% if event_id %}
                    <a href="{% url 'event_files' event_id=event_id %}" class="FileRef">
                        <i class="fa-solid fa-file fa-2x"></i>
                    </a>
                    {% endif %}
                </div>

                <div id="create-event-form">
                    <form method="POST">
                        {% csrf_token %}

                        {{ event_form }}
                        <br><br>

                        <div id="reminder_form_attribute">
                            <h3 style="color:white;"> Add Reminder: </h3>
                            {{ reminder_form }}
                        </div>
                        <button type="button" onclick="show_participants({{ is_creator }})">Show Participants</button>
                        <input type="submit" class="button" name="submit" value="create" />
                    </form>
                    
                </div>
            </div>
        </div>

        {% load static %}
        <script src="{% static 'reminders/reminder_form.js' %}"></script>
    {% endblock %}
